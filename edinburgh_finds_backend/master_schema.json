{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://example.com/schemas/online-directory-listing.json",
  "title": "Online Directory Listings",
  "description": "Schema for a single listing document that can be associated with multiple categories and entity types, with conditional properties based on entity type and specific category data.",
  "type": "object",
  "properties": {
    "listing_id": {
      "type": "string",
      "description": "A unique identifier for the listing (e.g., Company Registration Number, UUID, or internal ID)."
    },
    "entity_name": {
      "type": "string",
      "description": "The name of the listing (e.g., club name, venue name, retailer name)."
    },
    "entity_type": {
      "type": "string",
      "enum": [
        "venue",
        "members_club",
        "retailer",
        "tournament",
        "service",
        "coach",
        "cafe",
        "restaurant"
      ],
      "description": "The specific type of entity for the listing."
    },
    "primary_category": {
      "type": "string",
      "enum": [
        "padel",
        "pickleball",
        "board_games",
        "vegan_bakeries",
        "tennis",
        "squash",
        "racketball",
        "table_tennis",
        "gym"
      ],
      "description": "The main category the listing belongs to."
    },
    "additional_categories": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "padel",
          "pickleball",
          "board_games",
          "vegan_bakeries",
          "tennis",
          "squash",
          "racketball",
          "table_tennis",
          "gym"
        ]
      },
      "description": "A list of other categories this listing is associated with."
    },
    "cross_relationships": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "category": { "type": "string", "description": "Category of the related listing." },
          "entity_type": { "type": "string", "description": "Entity type of the related listing." },
          "listing_id": { "type": "string", "description": "The listing_id of the related listing." }
        },
        "required": ["category", "listing_id"],
        "description": "Links to other related listings, showing cross-relationships (e.g., a coach listing for a venue)."
      },
      "description": "Links to other related listings, showing cross-relationships."
    },
    "other_attributes": {
      "type": "object",
      "description": "A catch-all for any other relevant data not explicitly listed in the schema, enabling flexible discovery.",
      "additionalProperties": {
        "type": [
          "string",
          "number",
          "boolean",
          "array",
          "object",
          "null"
        ]
      }
    }
  },
  "required": [
    "listing_id",
    "name",
    "entity_type",
    "primary_category"
  ],
  "oneOf": [
    { "$ref": "#/definitions/venueListing" },
    { "$ref": "#/definitions/membersClubListing" },
    { "$ref": "#/definitions/retailerListing" },
    { "$ref": "#/definitions/tournamentListing" },
    { "$ref": "#/definitions/serviceListing" },
    { "$ref": "#/definitions/coachListing" },
    { "$ref": "#/definitions/cafeListing" },
    { "$ref": "#/definitions/restaurantListing" }
  ],
  "definitions": {
    "location": {
      "type": "object",
      "properties": {
        "address": { "type": "string", "description": "Street address of the entity." },
        "city": { "type": "string", "description": "City of the entity." },
        "postcode": { "type": "string", "description": "Postal code of the entity." },
        "coordinates": {
          "type": "array",
          "items": { "type": "number" },
          "minItems": 2,
          "maxItems": 2,
          "description": "[latitude, longitude] coordinates."
        }
      },
      "required": ["address", "city"]
    },
    "opening_hours": {
      "type": "object",
      "properties": {
        "opening_hours": {
          "type": "array",
          "description": "The general opening hours for a business, formatted according to Schema.org standards.",
          "items": {
            "type": "string",
            "pattern": "^(Mo|Tu|We|Th|Fr|Sa|Su)(?:,(Mo|Tu|We|Th|Fr|Sa|Su)){0,6}\\s+(?:\\d{2}:\\d{2}-\\d{2}:\\d{2}|Closed)$"
          }
        }
      },
      "required": ["opening_hours"]
    },
    "contact": {
      "type": "object",
      "properties": {
        "phone": { "type": "string", "description": "The primary phone number for the entity." },
        "email": { "type": "string", "format": "email", "description": "The primary email address for the entity." },
        "website": { "type": "string", "format": "uri", "description": "The official website URL." }
      }
    },
    "category_data": {
      "type": "object",
      "description": "A container for category-specific data, dynamically populated based on primary/additional categories.",
      "properties": {
        "padel": {
          "type": "object",
          "properties": {
            "number_of_courts": { "type": "integer" },
            "coaching_available": { "type": "boolean" },
            "court_surface": { "type": "string" },
            "is_indoor": { "type": "boolean" },
            "is_floodlit": { "type": "boolean" }
          },
          "required": ["number_of_courts"]
        },
        "pickleball": {
          "type": "object",
          "properties": {
            "number_of_courts": { "type": "integer" },
            "is_indoor": { "type": "boolean" },
            "coaching_available": { "type": "boolean" }
          },
          "required": ["number_of_courts"]
        },
        "tennis": {
          "type": "object",
          "properties": {
            "number_of_courts": { "type": "integer" },
            "is_indoor": { "type": "boolean" },
            "is_floodlit": { "type": "boolean" },
            "coaching_available": { "type": "boolean" }
          },
          "required": ["number_of_courts"]
        },
        "squash": {
          "type": "object",
          "properties": {
            "number_of_courts": { "type": "integer" },
            "coaching_available": { "type": "boolean" }
          },
          "required": ["number_of_courts"]
        },
        "racketball": {
          "type": "object",
          "properties": {
            "number_of_courts": { "type": "integer" },
            "coaching_available": { "type": "boolean" }
          },
          "required": ["number_of_courts"]
        },
        "table_tennis": {
          "type": "object",
          "properties": {
            "number_of_tables": { "type": "integer" },
            "coaching_available": { "type": "boolean" }
          },
          "required": ["number_of_tables"]
        },
        "gym": {
          "type": "object",
          "properties": {
            "has_personal_training": { "type": "boolean" },
            "equipment_types": { "type": "array", "items": { "type": "string" } }
          },
          "required": ["has_personal_training"]
        },
        "board_games": {
          "type": "object",
          "properties": {
            "games_library": {
              "type": "array",
              "items": { "type": "string" }
            },
            "rental_fee": { "type": "number" },
            "seating_capacity": { "type": "integer" }
          },
          "required": ["games_library"]
        },
        "vegan_bakeries": {
          "type": "object",
          "properties": {
            "gluten_free_options": { "type": "boolean" },
            "specialty_items": {
              "type": "array",
              "items": { "type": "string" }
            },
            "is_cafe": { "type": "boolean" }
          },
          "required": ["gluten_free_options"]
        }
      }
    },
    "venueListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "venue" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/opening_hours" },
          { "$ref": "#/definitions/contact" },
          { "$ref": "#/definitions/category_data" },
          {
            "properties": {
              "facilities": {
                "type": "array",
                "items": { "type": "string" },
                "description": "List of general facilities available at the venue (e.g., 'gym', 'bar', 'cafe')."
              },
              "booking_url": { "type": "string", "format": "uri" }
            },
            "required": ["facilities"]
          }
        ]
      }
    },
    "membersClubListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "members_club" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/opening_hours" },
          { "$ref": "#/definitions/contact" },
          { "$ref": "#/definitions/category_data" },
          {
            "properties": {
              "membership_fees": { "type": "string" },
              "is_invite_only": { "type": "boolean" }
            },
            "required": ["membership_fees"]
          }
        ]
      }
    },
    "retailerListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "retailer" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/opening_hours" },
          { "$ref": "#/definitions/contact" },
          { "$ref": "#/definitions/category_data" },
          {
            "properties": {
              "online_store_url": { "type": "string", "format": "uri" },
              "ships_internationally": { "type": "boolean" }
            },
            "required": ["online_store_url"]
          }
        ]
      }
    },
    "tournamentListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "tournament" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/contact" },
          {
            "properties": {
              "start_date": { "type": "string", "format": "date" },
              "end_date": { "type": "string", "format": "date" },
              "prize_pool": { "type": "number" },
              "organiser_website": { "type": "string", "format": "uri" }
            },
            "required": ["start_date", "organiser_website"]
          }
        ]
      }
    },
    "serviceListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "service" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/opening_hours" },
          { "$ref": "#/definitions/contact" },
          {
            "properties": {
              "service_type": { "type": "string" }
            },
            "required": ["service_type"]
          }
        ]
      }
    },
    "coachListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "coach" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/contact" },
          {
            "properties": {
              "certifications": { "type": "array", "items": { "type": "string" } },
              "specialty": { "type": "string" }
            },
            "required": ["certifications"]
          }
        ]
      }
    },
    "cafeListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "cafe" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/opening_hours" },
          { "$ref": "#/definitions/contact" },
          { "$ref": "#/definitions/category_data" },
          {
            "properties": {
              "seating_capacity": { "type": "integer" },
              "has_wifi": { "type": "boolean" },
              "menu_url": { "type": "string", "format": "uri" }
            },
            "required": ["seating_capacity", "menu_url"]
          }
        ]
      }
    },
    "restaurantListing": {
      "if": {
        "properties": {
          "entity_type": { "const": "restaurant" }
        }
      },
      "then": {
        "allOf": [
          { "$ref": "#/definitions/location" },
          { "$ref": "#/definitions/opening_hours" },
          { "$ref": "#/definitions/contact" },
          { "$ref": "#/definitions/category_data" },
          {
            "properties": {
              "cuisine_type": { "type": "string" },
              "reservations_required": { "type": "boolean" },
              "menu_url": { "type": "string", "format": "uri" }
            },
            "required": ["cuisine_type", "menu_url"]
          }
        ]
      }
    }
  }
}